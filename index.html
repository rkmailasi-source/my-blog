<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Blog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #faf9f6;
      --text: #1a1814;
      --muted: #8a8680;
      --accent: #c8643a;
      --border: #e8e5df;
      --max-width: 640px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 18px; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Lora', Georgia, serif;
      line-height: 1.75;
      min-height: 100vh;
      padding: 0 24px;
      -webkit-font-smoothing: antialiased;
    }

    .site-wrapper { max-width: var(--max-width); margin: 0 auto; }

    header {
      padding: 64px 0 48px;
      border-bottom: 1px solid var(--border);
      animation: fadeUp 0.6s ease both;
    }

    .site-name {
      font-family: 'DM Mono', monospace;
      font-size: 0.8rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      text-decoration: none;
      display: block;
      margin-bottom: 12px;
      cursor: pointer;
    }

    header h1 { font-size: 1.9rem; font-weight: 500; line-height: 1.25; letter-spacing: -0.02em; }
    header p.tagline { margin-top: 10px; color: var(--muted); font-style: italic; font-size: 0.95rem; }

    nav { margin-top: 24px; display: flex; gap: 24px; }

    nav a {
      font-family: 'DM Mono', monospace;
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      text-decoration: none;
      transition: color 0.2s;
      cursor: pointer;
    }

    nav a:hover, nav a.active { color: var(--text); }

    .view { display: none; animation: fadeUp 0.4s ease both; }
    .view.active { display: block; }

    /* Post List */
    .post-list { padding: 48px 0; }

    .post-item {
      display: flex;
      align-items: baseline;
      gap: 20px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
    }

    .post-date {
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem;
      color: var(--muted);
      white-space: nowrap;
      flex-shrink: 0;
      min-width: 90px;
    }

    .post-title-link {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text);
      text-decoration: none;
      transition: color 0.2s;
      line-height: 1.4;
    }

    .post-item:hover .post-title-link { color: var(--accent); }

    .post-tag {
      margin-left: auto;
      font-family: 'DM Mono', monospace;
      font-size: 0.68rem;
      letter-spacing: 0.06em;
      color: var(--muted);
      text-transform: uppercase;
      flex-shrink: 0;
    }

    .empty-state {
      padding: 64px 0;
      color: var(--muted);
      font-style: italic;
      font-size: 0.95rem;
    }

    /* Single Post */
    #post-view { padding: 48px 0; }

    .back-btn {
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      margin-bottom: 40px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s;
    }
    .back-btn:hover { color: var(--text); }

    .post-header { margin-bottom: 40px; }
    .post-header .post-date { display: block; margin-bottom: 12px; }
    .post-header h2 { font-size: 1.7rem; font-weight: 500; line-height: 1.25; letter-spacing: -0.02em; }

    .post-body { font-size: 1rem; line-height: 1.85; }
    .post-body p { margin-bottom: 1.4em; }
    .post-body p:last-child { margin-bottom: 0; }
    .post-body h2 { font-size: 1.2rem; font-weight: 500; margin: 2em 0 0.6em; letter-spacing: -0.01em; }
    .post-body h3 { font-size: 1rem; font-weight: 500; margin: 1.6em 0 0.5em; }
    .post-body ul, .post-body ol { margin: 0 0 1.4em 1.4em; }
    .post-body li { margin-bottom: 0.4em; }
    .post-body blockquote {
      border-left: 2px solid var(--accent);
      padding-left: 20px;
      margin: 1.6em 0;
      color: var(--muted);
      font-style: italic;
    }
    .post-body a { color: var(--accent); }
    .post-body strong { font-weight: 600; }
    .post-body em { font-style: italic; }
    .post-body hr { border: none; border-top: 1px solid var(--border); margin: 2em 0; }
    .post-body code {
      font-family: 'DM Mono', monospace;
      font-size: 0.82em;
      background: #f0ede8;
      padding: 2px 6px;
      border-radius: 3px;
    }

    /* About */
    #about-view { padding: 48px 0; }
    #about-view h2 { font-size: 1.4rem; font-weight: 500; margin-bottom: 20px; letter-spacing: -0.01em; }
    #about-view p { margin-bottom: 1.2em; }
    .contact-line { margin-top: 32px; font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--muted); }
    .contact-line a { color: var(--accent); text-decoration: none; }

    footer {
      padding: 32px 0 48px;
      font-family: 'DM Mono', monospace;
      font-size: 0.7rem;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 520px) {
      html { font-size: 16px; }
      .post-item { flex-wrap: wrap; gap: 4px; }
      .post-tag { display: none; }
    }
  </style>
</head>

<body>
  <div class="site-wrapper">

    <header>
      <span class="site-name" onclick="showView('home')">yourname</span>
      <h1>Notes on things that matter</h1>
      <p class="tagline">Writing to think clearly.</p>
      <nav>
        <a class="active" id="nav-home" onclick="showView('home')">Writing</a>
        <a id="nav-about" onclick="showView('about')">About</a>
      </nav>
    </header>

    <div id="home-view" class="view active">
      <div class="post-list" id="post-list"></div>
    </div>

    <div id="post-view" class="view">
      <button class="back-btn" onclick="showView('home')">← All posts</button>
      <div class="post-header">
        <span class="post-date" id="single-date"></span>
        <h2 id="single-title"></h2>
      </div>
      <div class="post-body" id="single-body"></div>
    </div>

    <div id="about-view" class="view">
      <h2>About</h2>
      <p>I write to think. This blog is a place for half-formed ideas, lessons from experience, and the occasional thing I can't stop thinking about.</p>
      <p>I'm interested in how people and organizations work, why some ideas spread and others don't, and what it means to build something worth building.</p>
      <p class="contact-line">Get in touch → <a href="mailto:you@example.com">you@example.com</a></p>
    </div>

    <footer>© 2025 Your Name</footer>
  </div>

  <!-- marked.js for markdown parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>

  <script>
    let allPosts = [];

    // Parse YAML-ish frontmatter from markdown files
    function parseFrontmatter(raw) {
      const match = raw.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
      if (!match) return { meta: {}, body: raw };
      const meta = {};
      match[1].split('\n').forEach(line => {
        const [key, ...rest] = line.split(':');
        if (key && rest.length) meta[key.trim()] = rest.join(':').trim().replace(/^["']|["']$/g, '');
      });
      return { meta, body: match[2].trim() };
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const d = new Date(dateStr);
      return isNaN(d) ? dateStr : d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
    }

    async function loadPosts() {
      try {
        // Fetch the posts manifest generated at build time
        const res = await fetch('/content/posts.json');
        if (!res.ok) throw new Error('no manifest');
        const files = await res.json();

        const posts = await Promise.all(
          files.map(async filename => {
            const r = await fetch(`/content/posts/${filename}`);
            const text = await r.text();
            const { meta, body } = parseFrontmatter(text);
            return { ...meta, body, filename };
          })
        );

        // Only published posts, newest first
        allPosts = posts
          .filter(p => p.draft !== 'true' && p.draft !== true)
          .sort((a, b) => new Date(b.date) - new Date(a.date));

        renderList();
      } catch (e) {
        renderList();
      }
    }

    function renderList() {
      const list = document.getElementById('post-list');
      if (!allPosts.length) {
        list.innerHTML = '<p class="empty-state">No posts yet. Write your first one from the admin panel.</p>';
        return;
      }
      list.innerHTML = allPosts.map((post, i) => `
        <div class="post-item" onclick="openPost(${i})">
          <span class="post-date">${formatDate(post.date)}</span>
          <span class="post-title-link">${post.title || 'Untitled'}</span>
          ${post.tags ? `<span class="post-tag">${post.tags}</span>` : ''}
        </div>
      `).join('');
    }

    function openPost(i) {
      const post = allPosts[i];
      document.getElementById('single-date').textContent = formatDate(post.date);
      document.getElementById('single-title').textContent = post.title || '';
      document.getElementById('single-body').innerHTML = marked.parse(post.body || '');
      showView('post');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showView(name) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(name + '-view').classList.add('active');
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
      document.getElementById(name === 'about' ? 'nav-about' : 'nav-home').classList.add('active');
    }

    loadPosts();
  </script>
</body>
</html>
